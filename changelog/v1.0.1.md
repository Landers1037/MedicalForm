# 版本更新日志 v1.0.1

**发布日期**: 2025年8月10日

## 🎯 主要功能更新

### 新增功能

#### 1. 药品爬虫系统
- **智能药品数据爬取**: 新增从国产药品数据库 `http://www.54md.com/guochanyaopin/` 自动抓取药品信息的功能
- **多种数据解析策略**: 支持表格、列表和文本格式的数据解析，适应不同网页结构
- **分页爬取支持**: 可配置爬取页数，默认爬取5页数据
- **智能数据提取**: 自动识别药品名称、生产厂家、价格和规格信息
- **数据去重机制**: 基于药品名称自动检测重复数据，避免重复插入

#### 2. 患者管理增强
- **患者时间线功能**: 在患者详情弹框中新增时间线视图，展示患者完整就诊历史
- **时间线交互**: 支持在患者详情和时间线视图之间切换
- **就诊记录排序**: 按时间从最新到最旧排序显示就诊记录
- **精准搜索优化**: 将患者查询从模糊匹配改为姓名精准匹配，提高搜索准确性

### 技术改进

#### 1. 后端架构
- **新增爬虫引擎**: 创建 `medicine.go` 文件，实现完整的药品爬虫功能
- **API接口扩展**: 新增药品爬取相关的API接口
  - `CrawlMedicineData()`: 单页药品数据爬取
  - `CrawlMedicineDataWithPages(maxPages)`: 分页药品数据爬取
  - `GetMedicineCount()`: 获取数据库药品数量统计
  - `ClearAllMedicines()`: 清空所有药品数据
- **依赖管理**: 添加 `github.com/PuerkitoBio/goquery` 依赖包用于HTML解析

#### 2. 前端界面
- **药品管理界面**: 在药品管理页面添加"爬取药品"按钮
- **状态反馈**: 爬取过程中显示加载状态和进度信息
- **结果统计**: 显示爬取前后的数据统计对比
- **自动刷新**: 爬取完成后自动更新药品列表
- **患者详情优化**: 新增时间线按钮和返回按钮，改善用户体验

#### 3. 数据处理
- **智能文本清理**: 自动清理和格式化爬取的数据
- **正则表达式匹配**: 精确提取价格、规格等结构化信息
- **错误处理机制**: 完善的网络错误和数据错误处理
- **请求频率控制**: 设置合理延时避免对目标网站造成压力

### 构建和部署

#### 1. 编译优化
- **版本控制**: 更新 `build.bat` 文件，添加 `-ldflags "-X main.Version=1.0.0"` 参数
- **动态版本**: 支持在编译时动态指定版本号
- **构建验证**: 确保所有新功能正常编译和运行

#### 2. 文档完善
- **功能说明**: 创建详细的药品爬虫功能说明文档
- **使用指南**: 提供完整的使用方法和配置说明
- **测试文件**: 创建独立的测试文件用于验证爬虫功能

## 🔧 技术细节

### 数据库变更
- 药品信息存储在 `medicine` 表中，包含以下字段：
  - `id`: 主键ID
  - `name`: 药品名称（必填）
  - `manufacturer`: 生产厂家
  - `price`: 价格信息
  - `specification`: 规格信息
  - `created_at`: 创建时间
  - `updated_at`: 更新时间

### 安全和性能
- **浏览器模拟**: 使用真实浏览器请求头提高爬取成功率
- **重复数据检查**: 在插入前检查是否存在重名药品，存在则跳过
- **内存优化**: 合理控制爬取频率和数据处理量
- **错误恢复**: 单个药品处理失败不影响整体爬取流程

## 📋 文件变更

### 新增文件
- `medicine.go` - 药品爬虫核心实现
- `test_medicine_crawler.go` - 爬虫功能测试文件
- `MEDICINE_CRAWLER_README.md` - 药品爬虫功能详细说明

### 修改文件
- `app.go` - 添加药品爬虫相关API接口
- `build.bat` - 更新编译命令，添加版本控制
- `go.mod` - 添加goquery依赖包
- `frontend/src/views/Medicine.vue` - 添加爬取功能界面
- `frontend/src/views/Panel.vue` - 添加患者时间线功能

## 🚀 使用说明

### 药品爬虫使用
1. 打开应用程序
2. 导航到"药品管理"页面
3. 点击"爬取药品"按钮
4. 确认爬取操作
5. 等待爬取完成并查看结果

### 患者时间线使用
1. 在患者管理页面选择患者
2. 点击"查看详情"按钮
3. 在详情弹框中点击"时间线"按钮
4. 查看患者完整就诊历史
5. 点击"返回患者详情"回到详情视图

## ⚠️ 注意事项

1. **网络依赖**: 药品爬虫功能需要稳定的网络连接
2. **目标网站**: 爬虫功能依赖于目标网站的结构稳定性
3. **法律合规**: 请确保爬取行为符合相关法律法规
4. **数据质量**: 爬取的数据质量取决于源网站的数据质量
5. **性能影响**: 大量数据爬取可能影响应用响应速度

## 🔄 兼容性

- **操作系统**: Windows 10/11
- **数据库**: SQLite（向后兼容）
- **前端框架**: Vue 3 + Element Plus
- **后端框架**: Wails v2 + Go 1.23

---

**开发团队**: MedicalForm Development Team  
**技术支持**: 如有问题请查看相关文档或联系开发团队